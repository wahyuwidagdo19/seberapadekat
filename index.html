<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Seberapa Dekat Kamu dengan Wahyu</title>

<style>
body{
  margin:0;height:100vh;
  background:linear-gradient(135deg,#0b0b0b,#1e1e1e);
  color:white;font-family:Arial;
  display:flex;justify-content:center;align-items:center;
}
.card{
  background:rgba(255,255,255,.06);
  padding:30px;border-radius:18px;
  width:360px;text-align:center;
  box-shadow:0 0 40px rgba(0,0,0,.8);
}
h1{color:#00ffcc}
button,input{
  width:100%;padding:12px;border-radius:25px;
  border:none;margin:8px 0;font-weight:bold;
}
button{background:#00ffcc;cursor:pointer}
button:disabled{opacity:.6}
.correct{background:#2ecc71!important;color:black}
.wrong{background:#ff4d4d!important;color:white}
.topbar{display:flex;justify-content:space-between;font-size:14px;margin-bottom:8px}
.progress{color:#00ffcc}
.timer{color:#ffcc00}
.leaderboard{text-align:left;margin-top:15px}
.leaderboard li{margin:6px 0}
.badge{background:#222;padding:6px 10px;border-radius:15px;margin:4px;display:inline-block}
</style>
</head>

<body>
<div class="card" id="app">
  <h1>Seberapa Dekat<br>dengan Wahyu?</h1>
  <input id="nameInput" placeholder="Nama lu...">
  <button onclick="start()">START</button>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ================= FIREBASE ================= */
firebase.initializeApp({
  apiKey: "AIzaSyBFhb3EVXEsWaqi83nBmSgl8bbQ5bRgLUg",
  authDomain: "leader-112c2.firebaseapp.com",
  databaseURL: "https://leader-112c2-default-rtdb.firebaseio.com",
  projectId: "leader-112c2",
  storageBucket: "leader-112c2.firebasestorage.app",
  messagingSenderId: "1022417648834",
  appId: "1:1022417648834:web:b648164104585fe314f5b"
});
const db = firebase.database();

/* ================= DEVICE ID ================= */
let deviceId = localStorage.getItem("deviceId");
if(!deviceId){
  deviceId = "dev-" + Math.random().toString(36).slice(2,10);
  localStorage.setItem("deviceId", deviceId);
}

/* ================= DATA ================= */
const RESET_CODE = "192011";
let score=0, index=0, player="";
let timeLeft=5, timer, locked=false;

const questions=[
 {q:"Buah favorit Wahyu?",o:["ğŸ Apel","ğŸŠ Jeruk","ğŸŒ Pisang"],c:"ğŸŠ Jeruk"},
 {q:"Lagu favorit Wahyu?",o:["ğŸ¸ Don't Look Back in Anger","ğŸ§ Yellow","ğŸ¶ Fix You"],c:"ğŸ¸ Don't Look Back in Anger"},
 {q:"Hobi utama Wahyu?",o:["ğŸ“– Membaca","ğŸ® Bermain Game","ğŸ˜´ Tidur"],c:"ğŸ® Bermain Game"},
 {q:"Game favorit Wahyu?",o:["âš½ FIFA","ğŸ”¥ Mobile Legends","ğŸ§± Minecraft"],c:"ğŸ”¥ Mobile Legends"},
 {q:"Rank tertinggi Wahyu?",o:["Mythic","ğŸ‘‘ Immortal","Legend"],c:"ğŸ‘‘ Immortal"}
];

/* ================= SOUND ================= */
const AudioCtx = new (window.AudioContext || window.webkitAudioContext)();
function beep(f){
  const o = AudioCtx.createOscillator();
  const g = AudioCtx.createGain();
  o.frequency.value = f;
  o.connect(g); g.connect(AudioCtx.destination);
  o.start(); g.gain.exponentialRampToValueAtTime(.0001, AudioCtx.currentTime+.15);
  o.stop(AudioCtx.currentTime+.15);
}

/* ================= CONFETTI ================= */
function confetti(){
  for(let i=0;i<80;i++){
    const c=document.createElement("div");
    c.style=`position:fixed;left:${Math.random()*100}%;
    top:-10px;width:6px;height:6px;
    background:hsl(${Math.random()*360},100%,50%);
    animation:fall 2s linear`;
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),2000);
  }
}
document.head.insertAdjacentHTML("beforeend",
`<style>@keyframes fall{to{transform:translateY(110vh)}}</style>`);

/* ================= START ================= */
function start(){
  player = nameInput.value.trim();
  if(!player) return alert("Nama dulu ğŸ˜…");
  score=0; index=0;
  showQ();
}

/* ================= QUESTION ================= */
function showQ(){
  locked=false;
  clearInterval(timer);
  timeLeft=5;

  const q = questions[index];
  const progress = Math.round((index/questions.length)*100);

  app.innerHTML=`
    <div class="topbar">
      <div class="progress">${progress}%</div>
      <div class="timer">â± ${timeLeft}</div>
    </div>
    <h1>${q.q}</h1>
  `;

  shuffle([...q.o]).forEach(ans=>{
    const b=document.createElement("button");
    b.textContent=ans;
    b.onclick=()=>answer(b,ans);
    app.appendChild(b);
  });

  timer = setInterval(()=>{
    timeLeft--;
    document.querySelector(".timer").textContent = "â± "+timeLeft;
    if(timeLeft<=0){
      clearInterval(timer);
      beep(200);
      next();
    }
  },1000);
}

function answer(btn, ans){
  if(locked) return;
  locked=true;
  clearInterval(timer);
  document.querySelectorAll("button").forEach(b=>b.disabled=true);
  if(ans === questions[index].c){
    score++; btn.classList.add("correct"); beep(800);
  }else{
    btn.classList.add("wrong"); beep(200);
  }
  setTimeout(next,500);
}

function next(){
  index<questions.length-1 ? (index++, showQ()) : result();
}

/* ================= RESULT + 1 DEVICE 1 SCORE ================= */
function result(){
  const percent = Math.round(score/questions.length*100);
  if(percent===100) confetti();

  const ref = db.ref("leaderboard/"+deviceId);
  ref.once("value", snap=>{
    const old = snap.val();
    if(!old || percent>old.percent){
      ref.set({name:player, percent, time:Date.now()});
    }
    loadLeaderboard();
  });
}

/* ================= LEADERBOARD ================= */
function loadLeaderboard(){
  db.ref("leaderboard").once("value", snap=>{
    const data=[];
    snap.forEach(x=>data.push(x.val()));
    // urut berdasarkan percent desc, time asc
    data.sort((a,b)=>{
      if(b.percent!==a.percent) return b.percent-a.percent;
      return a.time-b.time;
    });
    const top5 = data.slice(0,5);

    app.innerHTML=`
      <h1>Hasil Lu</h1>
      <p>${player}</p>
      ${top5.some(x=>x.percent===100)?'<div class="badge">ğŸ‘‘ TRUE BROTHER</div>':""}
      <div class="leaderboard">
        <h3>ğŸ† Leaderboard</h3>
        <ol>
          ${top5.map((x,i)=>`<li>${i===0?"ğŸ‘‘ ":"#"+(i+1)+" "}${x.name} â€” ${x.percent}%</li>`).join("")}
        </ol>
      </div>
      <button onclick="location.reload()">Main Lagi</button>
      <button onclick="resetLB()">Reset Leaderboard</button>
    `;
  });
}

/* ================= RESET ================= */
function resetLB(){
  if(prompt("Kode reset:")==RESET_CODE){
    db.ref("leaderboard").remove();
    localStorage.removeItem("deviceId");
    alert("Leaderboard berhasil di-reset");
    location.reload();
  }
}

function shuffle(a){return a.sort(()=>Math.random()-.5);}
</script>
</body>
</html>