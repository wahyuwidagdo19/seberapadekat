<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wahyu Quiz: God Tier</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<style>
:root { --accent: #00ffcc; --error: #ff4d4d; --gold: #ffd700; --glass: rgba(255,255,255,0.03); }
body { margin:0; min-height:100vh; background:#050505; color:white; font-family:'Inter',sans-serif; display:flex; flex-direction:column; align-items:center; padding:20px; overflow-x:hidden;}
#canvas-bg{position:fixed;top:0;left:0;z-index:-1;}
.main-wrapper{width:100%;max-width:450px;z-index:10;margin-top:20px;}
.card{background:var(--glass);backdrop-filter:blur(25px);border:1px solid rgba(0,255,204,0.15);border-radius:32px;padding:30px 20px;text-align:center;box-shadow:0 25px 50px rgba(0,0,0,0.5);}
h1{font-size:2rem;background:linear-gradient(to right,#00ffcc,#0099ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin:10px 0;}
input{width:100%;padding:16px;border-radius:16px;border:1px solid rgba(255,255,255,0.1);background:rgba(0,0,0,0.4);color:white;box-sizing:border-box;margin-bottom:15px;}
.btn{width:100%;padding:16px;border-radius:18px;border:none;font-weight:800;cursor:pointer;transition:0.3s;background:var(--accent);color:#000;margin:5px 0;}
.btn-share{background:#25D366;color:white;margin-top:10px;}
.option-btn{background:rgba(255,255,255,0.06);color:white;border:1px solid rgba(255,255,255,0.08);}
.correct{background:#00ff88 !important;color:#000;}
.wrong{background:var(--error) !important;animation:headShake 0.4s;}
.timer-bar{width:100%;height:4px;background:rgba(255,255,255,0.1);border-radius:2px;margin-bottom:20px;overflow:hidden;}
.timer-fill{height:100%;background:var(--accent);width:100%;transition:width 1s linear;}
.leaderboard-card{margin-top:20px;background:rgba(0,0,0,0.6);padding:20px;border-radius:28px;border:1px solid rgba(255,255,255,0.05);width:100%;box-sizing:border-box;}
.rank-item{display:flex;justify-content:space-between;padding:12px;margin:5px 0;background:rgba(255,255,255,0.02);border-radius:10px;}
.reset-btn{width:100%;padding:12px;margin-top:10px;border-radius:16px;border:none;background:var(--error);color:white;font-weight:bold;cursor:pointer;}
</style>
</head>
<body>

<canvas id="canvas-bg"></canvas>

<div class="main-wrapper animate__animated animate__fadeIn">
  <div class="card" id="app">
    <h1>Wahyu Quiz</h1>
    <input id="nameInput" placeholder="Nama lu...">
    <button class="btn" onclick="start()">START</button>
  </div>
  <div id="leaderboard-section"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const RESET_CODE = "192011";

const config = {
  apiKey:"AIzaSyBFhb3EVXEsWaqi83nBmSgl8bbQ5bRgLUg",
  authDomain:"leader-112c2.firebaseapp.com",
  databaseURL:"https://leader-112c2-default-rtdb.firebaseio.com",
  projectId:"leader-112c2",
  storageBucket:"leader-112c2.firebasestorage.app",
  messagingSenderId:"1022417648834",
  appId:"1:1022417648834:web:b648164104585fe314f5b"
};
firebase.initializeApp(config);
const db=firebase.database();

let userID="user_"+Math.random().toString(36).substring(7);
let score=0,index=0,player="",timeLeft=5,timer,locked=false;

const questions=[
 {q:"Buah favorit Wahyu?",o:["üçé Apel","üçä Jeruk","üçå Pisang"],c:"üçä Jeruk"},
 {q:"Lagu favorit Wahyu?",o:["üé∏ Don't Look Back in Anger","üéß Yellow","üé∂ Fix You"],c:"üé∏ Don't Look Back in Anger"},
 {q:"Hobi utama Wahyu?",o:["üìñ Membaca","üéÆ Bermain Game","üò¥ Tidur"],c:"üéÆ Bermain Game"},
 {q:"Game favorit Wahyu?",o:["‚öΩ FIFA","üî• Mobile Legends","üß± Minecraft"],c:"üî• Mobile Legends"},
 {q:"Rank tertinggi Wahyu?",o:["Mythic","üëë Immortal","Legend"],c:"üëë Immortal"}
];

fetch('https://api.ipify.org?format=json').then(r=>r.json()).then(d=>userID=d.ip.replace(/\./g,'_'));

function start(){
  player=nameInput.value.trim();
  if(!player) return alert("Isi nama!");
  score=0; index=0;
  document.getElementById("leaderboard-section").innerHTML="";
  showQ();
}

function showQ(){
  locked=false; clearInterval(timer); timeLeft=5;
  const q=questions[index];
  app.innerHTML=`
    <div class="timer-bar"><div class="timer-fill" id="tfill"></div></div>
    <h2 class="animate__animated animate__fadeIn">${q.q}</h2>
    <div id="options"></div>
  `;
  [...q.o].sort(()=>Math.random()-0.5).forEach(ans=>{
    const b=document.createElement("button");
    b.className="btn option-btn";
    b.textContent=ans;
    b.onclick=()=>answer(b,ans);
    options.appendChild(b);
  });

  timer=setInterval(()=>{
    timeLeft--;
    document.getElementById("tfill").style.width=(timeLeft/5*100)+"%";
    if(timeLeft<=0){clearInterval(timer);next();}
  },1000);
}

function answer(btn,ans){
  if(locked) return;
  locked=true; clearInterval(timer);
  const correct=questions[index].c;
  if(ans===correct){score++;btn.classList.add("correct");} 
  else {btn.classList.add("wrong");document.querySelectorAll(".option-btn").forEach(b=>{if(b.textContent===correct)b.classList.add("correct");});}
  setTimeout(next,1000);
}

function next(){index<questions.length-1?(index++,showQ()):result();}

async function result(){
  const percent=Math.round(score/questions.length*100);
  app.innerHTML=`<h2>Menghitung kecocokan...</h2>`;

  try{
    const ref=db.ref("leaderboard/"+userID);
    const snap=await ref.get();
    const old=snap.val();
    if(!old || percent>old.percent) await ref.set({name:player,percent:percent,time:Date.now()});

    let msg = percent===100?"üî• TRUE BROTHER!":(percent>=60?"üòé AKRAB!":"üíÄ LU SIAPA?");

    app.innerHTML=`
      <div id="capture-area">
        <h1 style="font-size:3.5rem">${percent}%</h1>
        <h3>${msg}</h3>
        <p style="opacity:0.6">Nama: ${player}</p>
      </div>
      <button class="btn" onclick="location.reload()">COBA LAGI</button>
      <button class="btn btn-share" onclick="shareResult()">SHARE KE WA</button>
    `;
    
    renderLeaderboard();
  }catch(e){alert("Error simpan data");}
}

function renderLeaderboard(){
  const lbSec=document.getElementById("leaderboard-section");
  lbSec.innerHTML=`<div class="leaderboard-card"><h3>üèÜ HALL OF FAME</h3><div id="lbList"></div>
  <button class="reset-btn" onclick="resetLeaderboard()">RESET LEADERBOARD</button>
  </div>`;
  
  const lbList=document.getElementById("lbList");
  db.ref("leaderboard").on("value",snap=>{
    const data=[];
    snap.forEach(c=>data.push(c.val()));
    data.sort((a,b)=>b.percent-a.percent || a.time-b.time);
    if(lbList){
      lbList.innerHTML=data.slice(0,5).map((p,i)=>`
        <div class="rank-item ${i===0?'top1':''}">
          <span><b>${i+1}.</b> ${p.name}</span>
          <span style="color:var(--accent); font-weight:bold">${p.percent}%</span>
        </div>
      `).join("");
    }
  });
}

function resetLeaderboard(){
  const kode=prompt("Masukkan kode reset:");
  if(kode===RESET_CODE){
    db.ref("leaderboard").remove();
    alert("Leaderboard berhasil di-reset!");
    location.reload();
  } else alert("Kode salah!");
}

function shareResult(){
  const percent=Math.round(score/questions.length*100);
  const text=`Woi! Skor kedekatan gue sama Wahyu itu ${percent}%! Lu berapa? Cek di sini: ${window.location.href}`;
  window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`,'_blank');
}

// background particles
const canvas=document.getElementById('canvas-bg');
const ctx=canvas.getContext('2d'); let particles=[];
function init(){canvas.width=window.innerWidth; canvas.height=window.innerHeight;
for(let i=0;i<50;i++)particles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,s:Math.random()*2,d:Math.random()*0.5});}
function draw(){ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle="rgba(0,255,204,0.2)";
particles.forEach(p=>{ctx.beginPath(); ctx.arc(p.x,p.y,p.s,0,Math.PI*2); ctx.fill(); p.y+=p.d; if(p.y>canvas.height)p.y=0;});
requestAnimationFrame(draw);}
init(); draw();
</script>
</body>
</html>