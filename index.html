<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wahyu Quiz: Ultimate Edition</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<style>
  :root {
    --accent: #00ffcc;
    --error: #ff4d4d;
    --gold: #ffd700;
    --glass: rgba(255, 255, 255, 0.03);
  }

  body {
    margin: 0; min-height: 100vh;
    background: #050505; color: white;
    font-family: 'Plus Jakarta Sans', sans-serif;
    display: flex; flex-direction: column; align-items: center;
    overflow-x: hidden; padding: 20px;
  }

  #canvas-bg {
    position: fixed; top: 0; left: 0; z-index: -1;
  }

  .main-wrapper {
    width: 100%; max-width: 450px; z-index: 10; margin-top: 40px;
  }

  .card {
    background: var(--glass);
    backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
    border: 1px solid rgba(0, 255, 204, 0.15);
    border-radius: 32px; padding: 40px 25px;
    text-align: center; box-shadow: 0 25px 50px rgba(0,0,0,0.5);
  }

  h1 { 
    font-size: 2.2rem; font-weight: 800; margin-bottom: 5px;
    background: linear-gradient(to right, #00ffcc, #0099ff);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }

  .input-group { margin: 25px 0; position: relative; }
  
  input {
    width: 100%; padding: 18px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1);
    background: rgba(0,0,0,0.4); color: white; box-sizing: border-box;
    font-size: 1rem; transition: 0.3s;
  }

  input:focus { border-color: var(--accent); outline: none; box-shadow: 0 0 15px rgba(0,255,204,0.2); }

  .btn {
    width: 100%; padding: 18px; border-radius: 18px; border: none;
    font-weight: 800; cursor: pointer; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    background: var(--accent); color: #000; text-transform: uppercase;
  }

  .btn:hover { transform: scale(1.02) translateY(-2px); box-shadow: 0 15px 30px rgba(0,255,204,0.3); }

  .option-btn {
    background: rgba(255,255,255,0.06); color: white; border: 1px solid rgba(255,255,255,0.08);
    margin: 8px 0; text-transform: none; font-weight: 500;
  }

  .correct { background: #00ff88 !important; color: #000; font-weight: 800; }
  .wrong { background: var(--error) !important; animation: shake 0.4s; }

  @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-10px)} 75%{transform:translateX(10px)} }

  .timer-circle {
    font-size: 1.5rem; font-weight: 900; color: var(--accent);
    margin-bottom: 20px; display: block;
  }

  .leaderboard-card {
    margin-top: 30px; background: rgba(0,0,0,0.6); padding: 25px;
    border-radius: 28px; border: 1px solid rgba(255,255,255,0.05);
  }

  .rank-item {
    display: flex; justify-content: space-between; align-items: center;
    padding: 15px; margin: 8px 0; border-radius: 12px;
    background: rgba(255,255,255,0.02);
  }

  .gold-tag { color: var(--gold); font-weight: bold; }
</style>
</head>
<body>

<canvas id="canvas-bg"></canvas>

<div class="main-wrapper animate__animated animate__fadeIn">
  <div class="card" id="app">
    <h1>Wahyu Quiz</h1>
    <p style="opacity: 0.6">Edisi Ultimate: Buktikan Kedekatanmu</p>
    <div class="input-group">
      <input id="nameInput" placeholder="Ketik nama panggilan lu...">
    </div>
    <button class="btn" onclick="start()">Mulai Sekarang</button>
  </div>

  <div id="leaderboard-section" style="display: none;"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// --- FIREBASE ---
const config = {
  apiKey: "AIzaSyBFhb3EVXEsWaqi83nBmSgl8bbQ5bRgLUg",
  authDomain: "leader-112c2.firebaseapp.com",
  databaseURL: "https://leader-112c2-default-rtdb.firebaseio.com",
  projectId: "leader-112c2",
  storageBucket: "leader-112c2.firebasestorage.app",
  messagingSenderId: "1022417648834",
  appId: "1:1022417648834:web:b648164104585fe314f5b"
};
firebase.initializeApp(config);
const db = firebase.database();

// --- STATE ---
let userIP = "dev_" + Math.random().toString(36).substring(7);
let score=0, index=0, player="", timeLeft=5, timer, locked=false;

const questions=[
 {q:"Buah favorit Wahyu?",o:["üçé Apel","üçä Jeruk","üçå Pisang"],c:"üçä Jeruk"},
 {q:"Lagu favorit Wahyu?",o:["üé∏ Don't Look Back in Anger","üéß Yellow","üé∂ Fix You"],c:"üé∏ Don't Look Back in Anger"},
 {q:"Hobi utama Wahyu?",o:["üìñ Membaca","üéÆ Bermain Game","üò¥ Tidur"],c:"üéÆ Bermain Game"},
 {q:"Game favorit Wahyu?",o:["‚öΩ FIFA","üî• Mobile Legends","üß± Minecraft"],c:"üî• Mobile Legends"},
 {q:"Rank tertinggi Wahyu?",o:["Mythic","üëë Immortal","Legend"],c:"üëë Immortal"}
];

// --- SOUND SYSTEM ---
const AudioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(type) {
  const osc = AudioCtx.createOscillator();
  const gain = AudioCtx.createGain();
  osc.connect(gain); gain.connect(AudioCtx.destination);

  if(type === 'correct') {
    osc.frequency.setValueAtTime(600, AudioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(1000, AudioCtx.currentTime + 0.1);
    gain.gain.setValueAtTime(0.1, AudioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, AudioCtx.currentTime + 0.2);
  } else if(type === 'wrong') {
    osc.frequency.setValueAtTime(200, AudioCtx.currentTime);
    osc.frequency.linearRampToValueAtTime(50, AudioCtx.currentTime + 0.3);
    gain.gain.setValueAtTime(0.2, AudioCtx.currentTime);
    gain.gain.linearRampToValueAtTime(0.01, AudioCtx.currentTime + 0.3);
  } else if(type === 'perfect') {
    // Sound Victory (Multi-tone)
    [440, 554, 659].forEach((f, i) => {
      const o = AudioCtx.createOscillator();
      const g = AudioCtx.createGain();
      o.frequency.value = f;
      o.connect(g); g.connect(AudioCtx.destination);
      o.start(AudioCtx.currentTime + (i * 0.1));
      g.gain.setValueAtTime(0.1, AudioCtx.currentTime + (i * 0.1));
      g.gain.exponentialRampToValueAtTime(0.001, AudioCtx.currentTime + 0.5);
      o.stop(AudioCtx.currentTime + 0.6);
    });
    return;
  } else if(type === 'sad') {
    osc.type = 'sawtooth';
    osc.frequency.setValueAtTime(100, AudioCtx.currentTime);
    osc.frequency.linearRampToValueAtTime(20, AudioCtx.currentTime + 1);
    gain.gain.setValueAtTime(0.1, AudioCtx.currentTime);
    gain.gain.linearRampToValueAtTime(0.001, AudioCtx.currentTime + 1);
  }
  osc.start(); osc.stop(AudioCtx.currentTime + 0.5);
}

// --- BACKGROUND ANIMATION ---
const canvas = document.getElementById('canvas-bg');
const ctx = canvas.getContext('2d');
let particles = [];
function initCanvas() {
  canvas.width = window.innerWidth; canvas.height = window.innerHeight;
  for(let i=0; i<60; i++) particles.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, s:Math.random()*2, d:Math.random()*0.5});
}
function drawParticles() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = "rgba(0, 255, 204, 0.3)";
  particles.forEach(p => {
    ctx.beginPath(); ctx.arc(p.x, p.y, p.s, 0, Math.PI*2); ctx.fill();
    p.y += p.d; if(p.y > canvas.height) p.y = 0;
  });
  requestAnimationFrame(drawParticles);
}
initCanvas(); drawParticles();

// --- CORE LOGIC ---
fetch('https://api.ipify.org?format=json').then(r => r.json()).then(d => userIP = d.ip.replace(/\./g, '_'));

function start(){
  player = document.getElementById("nameInput").value.trim();
  if(!player) return alert("Woi, nama jangan kosong!");
  score=0; index=0;
  document.getElementById("leaderboard-section").style.display = "none";
  showQ();
}

function showQ(){
  locked=false; clearInterval(timer); timeLeft=5;
  const q = questions[index];
  app.innerHTML = `
    <span class="timer-circle animate__animated animate__pulse animate__infinite">${timeLeft}</span>
    <h2 class="animate__animated animate__fadeInRight">${q.q}</h2>
    <div id="options" style="margin-top:20px"></div>
  `;

  q.o.sort(() => Math.random() - 0.5).forEach(ans => {
    const b = document.createElement("button");
    b.className = "btn option-btn animate__animated animate__fadeInUp";
    b.textContent = ans;
    b.onclick = () => answer(b, ans);
    document.getElementById("options").appendChild(b);
  });

  timer = setInterval(() => {
    timeLeft--;
    const t = document.querySelector(".timer-circle");
    if(t) t.textContent = timeLeft;
    if(timeLeft <= 0) { clearInterval(timer); next(); }
  }, 1000);
}

function answer(btn, ans){
  if(locked) return;
  locked = true; clearInterval(timer);
  const correct = questions[index].c;
  
  if(ans === correct){
    score++; btn.classList.add("correct"); playSound('correct');
  } else {
    btn.classList.add("wrong"); playSound('wrong');
    document.querySelectorAll(".option-btn").forEach(b => {
      if(b.textContent === correct) b.classList.add("correct");
    });
  }
  setTimeout(next, 1200);
}

function next(){
  index < questions.length - 1 ? (index++, showQ()) : result();
}

function result(){
  const percent = Math.round((score / questions.length) * 100);
  db.ref("leaderboard/" + userIP).set({ name: player, percent: percent, time: Date.now() });

  let msg = "";
  if(percent === 100) { msg = "LEGENDARY BROTHER! üî•"; playSound('perfect'); }
  else if(percent >= 80) { msg = "GOKIL, DEKET BANGET! üòé"; playSound('correct'); }
  else if(percent < 40) { msg = "LU SIAPA COK? üíÄ"; playSound('sad'); }
  else { msg = "LUMAYAN LAH... üßê"; }

  app.innerHTML = `
    <div class="animate__animated animate__zoomIn">
      <h1 style="font-size:4rem">${percent}%</h1>
      <h3>${msg}</h3>
      <button class="btn" style="margin-top:20px" onclick="location.reload()">COBA LAGI</button>
    </div>
  `;

  renderLeaderboard();
}

function renderLeaderboard(){
  const lbSec = document.getElementById("leaderboard-section");
  lbSec.style.display = "block";
  lbSec.innerHTML = `
    <div class="leaderboard-card animate__animated animate__fadeInUp">
      <h3 style="color:var(--accent)">üèÜ HALL OF FAME</h3>
      <div id="lbList">Loading...</div>
      <p style="font-size:9px; opacity:0.2; margin-top:20px; cursor:pointer" onclick="resetLB()">RESET DATA</p>
    </div>
  `;

  db.ref("leaderboard").on("value", snap => {
    const data = [];
    snap.forEach(c => data.push(c.val()));
    data.sort((a,b) => b.percent - a.percent || a.time - b.time);
    
    const list = document.getElementById("lbList");
    if(list) {
      list.innerHTML = data.slice(0, 10).map((p, i) => `
        <div class="rank-item animate__animated animate__slideInLeft" style="animation-delay: ${i*0.1}s">
          <span class="${i===0?'gold-tag':''}"><b>${i+1}.</b> ${p.name}</span>
          <span style="font-weight:bold; color:var(--accent)">${p.percent}%</span>
        </div>
      `).join("");
    }
  });
}

function resetLB(){
  if(prompt("Reset Code:") === "192011") { db.ref("leaderboard").remove(); location.reload(); }
}
</script>
</body>
</html>